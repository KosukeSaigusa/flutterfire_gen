# Introduction

## Installation

Execute the following commands to install the necessary packages:

```sh
dart pub add dev:flutterfire_gen
dart pub add flutterfire_gen_annotation
dart pub add flutterfire_gen_utils

dart pub add dev:build_runner

dart pub add firebase_core
dart pub add cloud_firestore
```

Or, add the following lines to your `pubspec.yaml`:

```yaml title="pubspec.yaml"
name: your_app_name

environment:
  sdk: '>=3.0.0 <4.0.0'
  flutter: '>=3.0.0'

dependencies:
  cloud_firestore:
  firebase_core:
  flutter:
    sdk: flutter
  flutterfire_gen_annotation: ^{{ versions.flutterfire_gen_annotation }}
  flutterfire_gen_utils: ^{{ versions.flutterfire_gen_utils }}

dev_dependencies:
  build_runner:
  flutterfire_gen: ^{{ versions.flutterfire_gen }}
```

## Defining Document Schemas

You can define the schema for Cloud Firestore documents using the `@FirestoreDocument` annotation.

Below is an example of defining the `Todo` document for the `todos` collection.

```dart title="todo.dart"
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:flutterfire_gen_annotation/flutterfire_gen_annotation.dart';

part 'todo.flutterfire_gen.dart';

@FirestoreDocument(path: 'todos/{todoId}')
class Todo {
  const Todo({
    required this.title,
    required this.isCompleted,
    required this.createdAt,
    required this.updatedAt,
  });

  final String title;

  @ReadDefault(false)
  @CreateDefault(false)
  final bool isCompleted;

  @alwaysUseFieldValueServerTimestampWhenCreating
  final DateTime? createdAt;

  @alwaysUseFieldValueServerTimestampWhenCreating
  @alwaysUseFieldValueServerTimestampWhenUpdating
  final DateTime? updatedAt;
}
```

Specify the path of the document to be defined in the `path` of the `@FirestoreDocument` annotation.

Document ID segments should be enclosed in `{}` and end with `Id`.

```dart
@FirestoreDocument(path: 'todos/{todoId}')
```

Various annotations are applied to each field of the `todo` document, but for their explanations, see [Annotations for Fields](/field-annotations).

## コードを生成する

Execute `build_runner` to generate `todo.flutterfire_gen.dart`.

```sh
dart run build_runner build --delete-conflicting-outputs
```

Checking `todo.flutterfire_gen.dart`, you will see that various codes have been generated.

## Utilizing the Generated Query Class

Among them, the `TodoQuery` class will be frequently used.

The `TodoQuery` class provides methods for a full range of reading and writing of documents in the `todos` collection. All operations can be performed in the most optimal and type-safe manner.

For details of the query class, see [Query Class](/query).

### Executing Read Operations

For example, to fetch all documents from the `todo` collection, call the `fetchDocuments` method.

```dart
final query = TodoQuery();
final List<ReadTodo> todos = await query.fetchDocuments();
```

The return type is `Future<List<ReadTodo>>`.

`ReadTodo` is a type dedicated to reading `todo` documents.

Although the document ID field is not explicitly defined in the `Todo` class schema, `ReadTodo` always includes the `String` type `todoId`.

This is one of the benefits of using the `flutterfire_gen` package.

```dart
final ReadTodo todo = todos.first!;
print(todo.todoId); // fetched document ID.
```

For details on read-only types and reading operations, see [Reading Documents](/read-documents).

### Executing Create Operations

To create a document in the `todo` collection, call the `add` method.


```dart
final query = TodoQuery();
final DocumentReference<CreateTodo> documentReference = await query.add(
  createTodo: const CreateTodo(title: 'A new todo title'),
);
print(documentReference.id); // created document ID.
```

The `CreateTodo` type functions as a dedicated interface for creating `todo` documents.

The `isCompleted` field is an optional parameter with the `@CreateDefault(false)` annotation, and if omitted, defaults to `false`.

The `createdAt` and `updatedAt` fields for the document's creation and update timestamps are automatically set to `FieldValue.serverTimestamp()` due to the annotations `@alwaysUseFieldValueServerTimestampWhenCreating` and `@alwaysUseFieldValueServerTimestampWhenUpdating`.

There's no need to provide the document ID when creating (adding) the document.

Enjoy the benefits of the code generated by the `flutterfire_gen` package, providing the most optimal processes and interfaces for reading and creating.

For details on creation-only interfaces and creation processes, see [Creating Documents](/create-document).

### Executing Update Operations

To update a document in the `todo` collection, call the `update` method.

```dart
final query = TodoQuery();
await query.update(
  todoId: 'todoId',
  updateTodo: const UpdateTodo(isCompleted: true),
);
```

The `UpdateTodo` type functions as a dedicated interface for updating `todo` documents.

It accepts all updatable fields as optional arguments.

In the example above, only the specified `isCompleted` field is updated.

The `updatedAt` field for the document's update timestamp is automatically set to `FieldValue.serverTimestamp()` due to the `@alwaysUseFieldValueServerTimestampWhenUpdating` annotation.

For details on update-only interfaces and update processes, see [Updating Documents](/update-document).

### Executing Delete Operations

To delete a document from the `todo` collection, call the `delete` method.

```dart
final query = TodoQuery();
await query.delete(todoId: 'todoId');
```

Deleting a document only requires specifying the document ID, so no special interface is provided.

For details on the deletion process, see [Deleting Documents](/delete-document).

## Next Steps

Now that you have learned the basics of using the `flutterfire_gen` package, define document schemas tailored to your application, generate code, and enjoy a comfortable development experience!
